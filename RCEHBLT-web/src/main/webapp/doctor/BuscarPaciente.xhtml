<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <h:form id="buscaPaciente">
        <p:growl id="growl" showDetail="true"/>
        <div align="center">
            <p:panelGrid columns="2" id="datosPaciente" styleClass="companyHeaderGrid">
                <p:outputLabel for="Rut" value="Rut: "/>
                <p:autoComplete id="Rut" value="#{busqueda.rut}" completeMethod="#{busqueda.completarRut}" 
                                var="rut" itemLabel="#{rut}" itemValue="#{rut}" dropdown="true"/>
                <p:outputLabel for="Nombres" value="Nombre: "/>
                <p:autoComplete id="Nombres" value="#{busqueda.nombres}" completeMethod="#{busqueda.completarNombre}" 
                                var="nombre" itemLabel="#{nombre}" itemValue="#{nombre}" dropdown="true"/>
                <p:outputLabel for="ApePaterno" value="Apellido Paterno: "/>
                <p:autoComplete id="ApePaterno" value="#{busqueda.apePaterno}" completeMethod="#{busqueda.completarApePaterno}" 
                                var="paterno" itemLabel="#{paterno}" itemValue="#{paterno}" dropdown="true"/>
                <p:outputLabel for="ApeMaterno" value="Apellido Materno: "/>
                <p:autoComplete id="ApeMaterno" value="#{busqueda.apeMaterno}" completeMethod="#{busqueda.completarApeMaterno}" 
                                var="materno" itemLabel="#{materno}" itemValue="#{materno}" dropdown="true"/>
                <p:outputLabel for="Sexo" value="Sexo: "/>
                <p:selectOneMenu id="Sexo" value="#{busqueda.sexo}">
                    <f:selectItem itemLabel="Seleccionar" itemValue="#{0}"/>
                    <f:selectItem itemLabel="Hombre" itemValue="#{1}"/>
                    <f:selectItem itemLabel="Mujer" itemValue="#{2}"/>
                    <f:selectItem itemLabel="Indeterminado" itemValue="#{3}"/>
                    <f:selectItem itemLabel="Desconocido" itemValue="#{4}"/>
                </p:selectOneMenu>
                <p:outputLabel for="FechaNacimiento" value="Fecha de Nacimiento: "/>
                <p:calendar effect="explode" navigator="true" yearRange="c-100:c" id="FechaNacimiento" value="#{busqueda.fechaNacimiento}"/>
            </p:panelGrid>
            <p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{busqueda.buscar}" oncomplete="PF('Resultados').show()" update="buscaPaciente, ResultadosBusqueda"/>

            <p:dialog id="ResultadosBusqueda" widgetVar="Resultados" header="Resultados de Búsqueda" showEffect="fade" hideEffect="fade">
                <h:form>
                <p:dataTable emptyMessage="No se encontraron elementos que coincidan con la búsqueda" value="#{busqueda.listaPersonas}" var="persona">
                    <p:column headerText="Rut">
                        #{persona.persRut}-#{persona.persDv}
                    </p:column>
                    <p:column headerText="Nombres">
                        #{persona.persNombres}
                    </p:column>
                    <p:column headerText="Apellido Paterno">
                        #{persona.persApepaterno}
                    </p:column>
                    <p:column headerText="Apellido Materno">
                        #{persona.persApematerno}
                    </p:column>
                    <p:column headerText="Fecha Nacimiento">
                        #{persona.persFnacimiento}
                    </p:column>
                    <p:column headerText="Sexo">
                        #{persona.idGenero.generoNombre}
                    </p:column>
                    <p:column>
                        <p:commandButton value="Ver Episodios #{persona.idPersona}" oncomplete="PF('EpiPac').show()" action="#{episodioMB.buscarEpisodios()}" update=":buscaPaciente:Episodios, :buscaPaciente:AgregarEpisodio">
                            <f:setPropertyActionListener target="#{episodioMB.persona}" value="#{persona}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
                </h:form>
            </p:dialog>

            <p:dialog id="Episodios" widgetVar="EpiPac" showEffect="fade" hideEffect="fade" header="Episodios de #{episodioMB.persona.persNombres}">
                <h:form id="formEpisodio">
                    <p:dataTable value="#{episodioMB.listaEpisodios}" var="episodio">
                        <p:column headerText="Fecha">
                            #{episodio.fecha}
                        </p:column>
                        <p:column headerText="Motivo">
                            #{episodio.nombre}
                        </p:column>
                        <p:column>
                            <p:commandButton value="Boton">
                                <f:setPropertyActionListener target="#{episodioMB.episodio}" value="#{episodio}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="Agregar" onclick="PF('addEpi').show()"/>                                           
                </h:form>
            </p:dialog>

            <p:dialog id="AgregarEpisodio" widgetVar="addEpi" showEffect="fade" hideEffect="fade">
                <p:panelGrid columns="2">
                    <p:outputLabel value="Paciente"/>
                    <p:outputLabel value="#{episodioMB.persona.persNombres} #{episodioMB.persona.persApepaterno}"/>
                    <p:outputLabel value="Motivo episodio"/>
                    <p:inputText value="#{episodioMB.nombre}"/>
                    <p:commandButton value="Guardar" actionListener="#{episodioMB.nuevoEpisodio()}" update=":buscaPaciente:formEpisodio, :buscaPaciente"/>
                    <p:commandButton value="Cancelar" onclick="PF('addEpi').hide()"/>
                </p:panelGrid>

            </p:dialog>
        </div>
    </h:form>
</html>

